<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New GIF Maker | Multi-Tools</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background-color: #f0f2f5; }
        .main-container { max-width: 800px; margin: 2rem auto; background: #ffffff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .tool-header { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: white; padding: 1.5rem; }
        .tool-header h1 { font-size: 1.8rem; margin-bottom: 0; }
        .tool-content { padding: 2rem; }
        .upload-area { border: 3px dashed #d1d8e0; border-radius: 8px; padding: 2.5rem; text-align: center; background-color: #f8f9fa; }
        .upload-area i { font-size: 3rem; color: #6a11cb; }
        .image-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        .img-thumbnail { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; }
        #videoPreview { max-width: 100%; border-radius: 8px; background-color: #000; }
        .nav-tabs .nav-link.active { color: #2575fc; border-color: #2575fc #2575fc #fff; }
    </style>
</head>
<body>

    <!-- EMBEDDED HEADER -->
    <header class="clean-header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html"><i class="fas fa-tools"></i> Multi-Tools</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="image-resizer.html">Image Resizer</a></li>
                        <li class="nav-item"><a class="nav-link" href="word-counter.html">Word Counter</a></li>
                        <li class="nav-item"><a class="nav-link" href="new-gif-maker.html">GIF Maker</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- EMBEDDED AD SECTION -->
    <div class="container my-4">
        <div class="text-center" style="height:90px; background:#f1f1f1; border:1px dashed #ccc; display: flex; align-items: center; justify-content: center; color: #888;">Ad Space</div>
    </div>

    <!-- GIF MAKER TOOL -->
    <main class="main-container">
        <ul class="nav nav-tabs" id="gifModeTab" role="tablist">
            <li class="nav-item" role="presentation"><button class="nav-link active" id="images-tab" data-bs-toggle="tab" data-bs-target="#images-mode" type="button">Images to GIF</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" id="video-tab" data-bs-toggle="tab" data-bs-target="#video-mode" type="button">Video to GIF</button></li>
        </ul>
        <div class="tab-content" id="gifModeTabContent">
            <div class="tab-pane fade show active" id="images-mode" role="tabpanel">
                <div class="tool-header"><h1><i class="fas fa-images"></i> Create GIF from Images</h1></div>
                <div class="tool-content">
                    <div id="uploadArea" class="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p class="mt-3 mb-1"><strong>Drag & drop files here</strong> or</p>
                        <input type="file" id="imageInput" multiple accept="image/*" class="d-none">
                        <button class="btn btn-primary" onclick="document.getElementById('imageInput').click();">Browse Files</button>
                    </div>
                    <div id="imagePreview" class="image-preview-grid"></div>
                    <hr/>
                    <h5>Settings</h5>
                    <div class="slider-container mb-4">
                        <label for="frameDelay" class="form-label">Frame Delay: <span id="frameDelayValue">500</span> ms</label>
                        <input type="range" class="form-range" id="frameDelay" value="500" min="100" max="2000" step="50">
                    </div>
                    <div class="d-grid gap-2 mt-3"><button class="btn btn-success btn-lg" id="createImageGifBtn" disabled>Create GIF</button></div>
                </div>
            </div>
            <div class="tab-pane fade" id="video-mode" role="tabpanel">
                <div class="tool-header"><h1><i class="fas fa-video"></i> Create GIF from Video</h1></div>
                <div class="tool-content">
                    <input type="file" id="videoInput" accept="video/mp4,video/webm" class="form-control mb-3">
                    <div id="videoWorkspace" style="display: none;">
                        <video id="videoPreview" controls class="mb-3"></video>
                        <div class="mb-3"><label for="startTime">Start Time (s):</label><input type="number" id="startTime" class="form-control" value="0"></div>
                        <div class="mb-3"><label for="endTime">End Time (s):</label><input type="number" id="endTime" class="form-control" value="3"></div>
                        <div class="d-grid gap-2 mt-3"><button class="btn btn-success btn-lg" id="createVideoGifBtn">Create GIF</button></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="gifResult" class="tool-content text-center" style="display:none;">
            <hr/>
            <h3>Your GIF is Ready!</h3>
            <img id="generatedGif" class="img-fluid border rounded shadow-sm mb-3">
            <div id="loading-spinner" class="spinner-border text-primary my-4" role="status" style="display: none;"><span class="visually-hidden">Loading...</span></div>
            <a href="#" class="btn btn-primary" id="downloadGifBtn" download="new.gif"><i class="fas fa-download"></i> Download GIF</a>
        </div>
    </main>

    <!-- EMBEDDED FOOTER -->
    <footer class="bg-light text-center mt-4 p-3">Â© 2024 Multi-Tools. All rights reserved.</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Init Bootstrap
        var dropdownElementList = [].slice.call(document.querySelectorAll('[data-bs-toggle="dropdown"]'));
        var dropdownList = dropdownElementList.map(function (dropdownToggleEl) { return new bootstrap.Dropdown(dropdownToggleEl) });

        // --- All DOM Elements ---
        const imageInput = document.getElementById('imageInput');
        const uploadArea = document.getElementById('uploadArea');
        const imagePreview = document.getElementById('imagePreview');
        const createImageGifBtn = document.getElementById('createImageGifBtn');
        const frameDelay = document.getElementById('frameDelay');
        const frameDelayValue = document.getElementById('frameDelayValue');
        
        const videoInput = document.getElementById('videoInput');
        const videoWorkspace = document.getElementById('videoWorkspace');
        const videoPreview = document.getElementById('videoPreview');
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');
        const createVideoGifBtn = document.getElementById('createVideoGifBtn');

        const gifResult = document.getElementById('gifResult');
        const generatedGif = document.getElementById('generatedGif');
        const downloadGifBtn = document.getElementById('downloadGifBtn');
        const loadingSpinner = document.getElementById('loading-spinner');
        
        let uploadedImages = [];
        let workerScriptUrl = null;

        // --- Logic for Images to GIF ---
        uploadArea.addEventListener('click', () => imageInput.click());
        imageInput.addEventListener('change', (e) => handleFiles(e.target.files));
        frameDelay.addEventListener('input', (e) => { frameDelayValue.textContent = e.target.value; });
        createImageGifBtn.addEventListener('click', () => generateGifFromImages());

        function handleFiles(files) {
            uploadedImages = [];
            imagePreview.innerHTML = '';
            Array.from(files).filter(f => f.type.startsWith('image/')).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'img-thumbnail';
                    imagePreview.appendChild(img);
                    uploadedImages.push(img);
                };
                reader.readAsDataURL(file);
            });
            createImageGifBtn.disabled = false;
        }

        // --- Logic for Video to GIF ---
        videoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                videoPreview.src = URL.createObjectURL(file);
                videoWorkspace.style.display = 'block';
            }
        });
        createVideoGifBtn.addEventListener('click', () => generateGifFromVideo());

        // --- Shared GIF Generation Logic ---
        async function getWorkerUrl() {
            if (workerScriptUrl) return workerScriptUrl;
            try {
                const response = await fetch('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');
                const scriptText = await response.text();
                workerScriptUrl = URL.createObjectURL(new Blob([scriptText], { type: 'application/javascript' }));
                return workerScriptUrl;
            } catch (error) {
                alert('Could not load a critical component. Please check your internet connection.');
                return null;
            }
        };

        async function generateGifFromImages() {
            if (uploadedImages.length === 0) return;
            showLoading(true);
            const workerUrl = await getWorkerUrl();
            if (!workerUrl) { showLoading(false); return; }

            const gif = new GIF({ workers: 2, quality: 10, workerScript: workerUrl });
            uploadedImages.forEach(img => {
                gif.addFrame(img, { delay: parseInt(frameDelay.value, 10) });
            });
            finishGif(gif);
        }

        async function generateGifFromVideo() {
            showLoading(true);
            const workerUrl = await getWorkerUrl();
            if (!workerUrl) { showLoading(false); return; }

            const gif = new GIF({ workers: 2, quality: 10, workerScript: workerUrl, width: videoPreview.videoWidth, height: videoPreview.videoHeight });
            
            const canvas = document.createElement('canvas');
            canvas.width = videoPreview.videoWidth;
            canvas.height = videoPreview.videoHeight;
            const ctx = canvas.getContext('2d');
            
            const frameDelay = 100; // ~10 FPS
            for (let t = parseFloat(startTimeInput.value); t < parseFloat(endTimeInput.value); t += (frameDelay / 1000)) {
                videoPreview.currentTime = t;
                await new Promise(r => videoPreview.onseeked = r);
                ctx.drawImage(videoPreview, 0, 0, canvas.width, canvas.height);
                gif.addFrame(canvas, { copy: true, delay: frameDelay });
            }
            finishGif(gif);
        }

        function finishGif(gifInstance) {
            gifInstance.on('finished', (blob) => {
                const url = URL.createObjectURL(blob);
                generatedGif.src = url;
                downloadGifBtn.href = url;
                gifResult.style.display = 'block';
                showLoading(false);
            });
            gifInstance.render();
        }

        function showLoading(isLoading) {
            loadingSpinner.style.display = isLoading ? 'block' : 'none';
        }
    });
    </script>
</body>
</html> 