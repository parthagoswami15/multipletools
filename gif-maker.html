<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered GIF Maker | Multi-Tools</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background-color: #f0f2f5;
        }
        .gif-maker-container {
            max-width: 800px;
            margin: 2rem auto;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .step-header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
        }
        .step-header h1 {
            font-size: 1.8rem;
            margin-bottom: 0;
        }
        .step-content {
            padding: 2rem;
        }
        .upload-area {
            border: 3px dashed #d1d8e0;
            border-radius: 8px;
            padding: 2.5rem;
            text-align: center;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        .upload-area.drag-over {
            border-color: #2575fc;
            background-color: #e9f1ff;
        }
        .upload-area i {
            font-size: 3rem;
            color: #6a11cb;
        }
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .img-thumbnail-wrapper {
            position: relative;
        }
        .img-thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
        .slider-container label {
            font-weight: 500;
        }
        #gif-preview-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
        }
        #generatedGif {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>
    <div id="ad-placeholder"></div>

    <div class="gif-maker-container">
        <!-- Step 1: Upload -->
        <div id="step1" class="step active">
            <div class="step-header">
                <h1><i class="fas fa-upload"></i> Step 1: Upload Your Images</h1>
            </div>
            <div class="step-content">
                <div id="uploadArea" class="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p class="mt-3 mb-1"><strong>Drag & drop files here</strong></p>
                    <p class="text-muted">or</p>
                    <input type="file" id="imageInput" multiple accept="image/*" class="d-none">
                    <button class="btn btn-primary" onclick="document.getElementById('imageInput').click();">Browse Files</button>
                </div>
                <div id="imagePreview" class="image-preview-grid"></div>
                <div class="text-end mt-4">
                    <button class="btn btn-success btn-lg" id="toStep2Btn" disabled>Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>

        <!-- Step 2: Customize & Preview -->
        <div id="step2" class="step">
            <div class="step-header">
                <h1><i class="fas fa-sliders-h"></i> Step 2: Customize & Preview</h1>
            </div>
            <div class="step-content">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div id="gif-preview-container" class="text-center">
                            <p><strong>Live Preview</strong></p>
                            <img id="generatedGif" alt="GIF Preview">
                            <div id="loading-spinner" class="spinner-border text-primary my-4" role="status" style="display: none;">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="slider-container mb-4">
                            <label for="frameDelay" class="form-label">Frame Delay: <span id="frameDelayValue">500</span> ms</label>
                            <input type="range" class="form-range" id="frameDelay" value="500" min="100" max="2000" step="50">
                        </div>
                        <div class="slider-container mb-4">
                            <label for="gifQuality" class="form-label">Quality (1 is best): <span id="gifQualityValue">10</span></label>
                            <input type="range" class="form-range" id="gifQuality" value="10" min="1" max="30" step="1">
                        </div>
                         <div class="d-grid gap-2">
                             <button class="btn btn-info" id="regenerateBtn"><i class="fas fa-sync-alt"></i> Regenerate Preview</button>
                         </div>
                    </div>
                </div>
                 <div class="d-flex justify-content-between mt-4">
                    <button class="btn btn-secondary" id="backToStep1Btn"><i class="fas fa-arrow-left"></i> Back</button>
                    <button class="btn btn-success btn-lg" id="toStep3Btn">Finalize & Download <i class="fas fa-check"></i></button>
                </div>
            </div>
        </div>

        <!-- Step 3: Download -->
        <div id="step3" class="step">
             <div class="step-header">
                <h1><i class="fas fa-download"></i> Step 3: Download Your GIF</h1>
            </div>
            <div class="step-content text-center">
                <p class="lead">Your GIF is ready!</p>
                <img id="finalGif" class="img-fluid border rounded shadow-sm mb-4" alt="Final GIF">
                <div class="d-grid gap-2 col-6 mx-auto">
                    <a href="#" class="btn btn-success btn-lg" id="downloadGifBtn" download="made-with-multitools.gif">
                        <i class="fas fa-download"></i> Download GIF
                    </a>
                    <button class="btn btn-outline-primary" id="startOverBtn"><i class="fas fa-redo"></i> Create Another</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="footer-placeholder"></div> 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <script src="main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let uploadedImages = [];
            let generatedGifBlob = null;
            let workerScriptUrl = null;

            // --- UI Elements ---
            const steps = {
                step1: document.getElementById('step1'),
                step2: document.getElementById('step2'),
                step3: document.getElementById('step3'),
            };
            const uploadArea = document.getElementById('uploadArea');
            const imageInput = document.getElementById('imageInput');
            const imagePreview = document.getElementById('imagePreview');
            const toStep2Btn = document.getElementById('toStep2Btn');
            const backToStep1Btn = document.getElementById('backToStep1Btn');
            const toStep3Btn = document.getElementById('toStep3Btn');
            const startOverBtn = document.getElementById('startOverBtn');
            const generatedGif = document.getElementById('generatedGif');
            const finalGif = document.getElementById('finalGif');
            const downloadGifBtn = document.getElementById('downloadGifBtn');
            const frameDelay = document.getElementById('frameDelay');
            const gifQuality = document.getElementById('gifQuality');
            const frameDelayValue = document.getElementById('frameDelayValue');
            const gifQualityValue = document.getElementById('gifQualityValue');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const loadingSpinner = document.getElementById('loading-spinner');

            // --- Navigation ---
            const navigateTo = (step) => {
                Object.values(steps).forEach(s => s.classList.remove('active'));
                steps[step].classList.add('active');
            };

            toStep2Btn.addEventListener('click', () => {
                navigateTo('step2');
                generatePreview();
            });

            backToStep1Btn.addEventListener('click', () => navigateTo('step1'));
            
            toStep3Btn.addEventListener('click', () => {
                finalGif.src = generatedGif.src;
                downloadGifBtn.href = URL.createObjectURL(generatedGifBlob);
                navigateTo('step3');
            });

            startOverBtn.addEventListener('click', () => {
                uploadedImages = [];
                generatedGifBlob = null;
                imageInput.value = '';
                imagePreview.innerHTML = '';
                toStep2Btn.disabled = true;
                navigateTo('step1');
            });
            
            regenerateBtn.addEventListener('click', () => generatePreview());
            frameDelay.addEventListener('input', (e) => frameDelayValue.textContent = e.target.value);
            gifQuality.addEventListener('input', (e) => gifQualityValue.textContent = e.target.value);


            // --- File Upload ---
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('drag-over'));
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                handleFiles(e.dataTransfer.files);
            });
            imageInput.addEventListener('change', (e) => handleFiles(e.target.files));

            const handleFiles = (files) => {
                uploadedImages = [];
                imagePreview.innerHTML = '';
                const imageFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
                if (imageFiles.length === 0) return;

                imageFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.src = e.target.result;
                        img.className = 'img-thumbnail';
                        uploadedImages.push(img);
                        
                        const wrapper = document.createElement('div');
                        wrapper.className = 'img-thumbnail-wrapper';
                        wrapper.appendChild(img);
                        imagePreview.appendChild(wrapper);
                    };
                    reader.readAsDataURL(file);
                });
                toStep2Btn.disabled = false;
            };
            
            // --- GIF Generation ---
            const prepareWorker = async () => {
                if (workerScriptUrl) return workerScriptUrl;
                try {
                    const response = await fetch('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const scriptText = await response.text();
                    const blob = new Blob([scriptText], { type: 'application/javascript' });
                    workerScriptUrl = URL.createObjectURL(blob);
                    return workerScriptUrl;
                } catch (error) {
                    console.error('Failed to create worker from blob:', error);
                    alert(`Could not fetch the GIF worker script. Please check your internet connection. Details: ${error.message}`);
                    return 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js'; // Fallback
                }
            };
            
            const generatePreview = async () => {
                if (uploadedImages.length === 0) return;

                loadingSpinner.style.display = 'block';
                generatedGif.style.display = 'none';
                
                const workerUrl = await prepareWorker();

                const gif = new GIF({
                    workers: 2,
                    quality: parseInt(gifQuality.value, 10),
                    workerScript: workerUrl
                });

                uploadedImages.forEach(img => {
                    gif.addFrame(img, { delay: parseInt(frameDelay.value, 10) });
                });

                gif.on('finished', (blob) => {
                    generatedGifBlob = blob;
                    const url = URL.createObjectURL(blob);
                    generatedGif.src = url;
                    loadingSpinner.style.display = 'none';
                    generatedGif.style.display = 'block';
                });

                gif.on('abort', () => {
                     alert('GIF creation aborted. Please try again.');
                     loadingSpinner.style.display = 'none';
                });

                try {
                    gif.render();
                } catch (error) {
                    alert(`An error occurred while creating the GIF preview. Details: ${error.message}`);
                    loadingSpinner.style.display = 'none';
                }
            };
        });
    </script>
</body>
</html> 